<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Batch Processing - SmartCrop AI</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="header">
    <nav class="navbar container">
      <a href="dashboard.html" class="logo">üåæ Smart<span style="color: #90be6d;">Crop</span></a>
      <a href="dashboard.html" class="btn btn-secondary">‚Üê Dashboard</a>
    </nav>
  </header>

  <div class="container" style="padding: 2rem 0;">
    <h1>üì¶ Batch Processing</h1>
    <p style="color: #6b7280; margin-bottom: 2rem;">Queue: <span id="queueCount">0</span> images</p>

    <div id="batchList" class="dashboard-grid"></div>

    <div style="text-align: center; margin: 3rem 0;">
      <button id="processBatch" class="btn btn-primary" onclick="processBatch()" disabled style="font-size: 1.2rem; padding: 1.5rem 3rem;">
        ‚ö° PROCESS BATCH
      </button>
      <button onclick="clearBatch()" class="btn btn-secondary" style="margin-left: 1rem;">üóëÔ∏è Clear</button>
    </div>

    <div id="progressContainer" style="display: none;">
      <div class="card">
        <div style="width: 100%; height: 20px; background: #e5e7eb; border-radius: 10px; overflow: hidden;">
          <div id="progressBar" style="height: 100%; background: linear-gradient(90deg, #10b981, #3b82f6); width: 0%; transition: width 0.3s;"></div>
        </div>
        <p id="progressText" style="text-align: center; margin-top: 1rem; font-weight: 600;">Processing...</p>
      </div>
    </div>
  </div>

  <script>
    function loadBatch() {
      const batch = JSON.parse(localStorage.getItem('smartcrop_batch') || '[]');
      document.getElementById('queueCount').textContent = batch.length;
      document.getElementById('processBatch').disabled = batch.length === 0;
      
      const container = document.getElementById('batchList');
      container.innerHTML = batch.map((item, i) => `
        <div class="card">
          <img src="${item.src || item.data}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 12px; margin-bottom: 1rem;">
          <p>${item.ratio || '1:1'} | <small>${new Date(item.timestamp || Date.now()).toLocaleTimeString()}</small></p>
          <button onclick="removeBatchItem(${i})" class="btn btn-secondary" style="width: 100%;">Remove</button>
        </div>
      `).join('');
    }

    function processBatch() {
      document.getElementById('progressContainer').style.display = 'block';
      let progress = 0;
      
      const interval = setInterval(() => {
        progress += 10;
        document.getElementById('progressBar').style.width = progress + '%';
        document.getElementById('progressText').textContent = `Processing ${progress}%...`;
        
        if (progress >= 100) {
          clearInterval(interval);
          setTimeout(() => {
            alert('‚úÖ Batch complete! Download folder ready');
            localStorage.removeItem('smartcrop_batch');
            loadBatch();
            document.getElementById('progressContainer').style.display = 'none';
          }, 500);
        }
      }, 300);
    }

    function removeBatchItem(index) {
      const batch = JSON.parse(localStorage.getItem('smartcrop_batch') || '[]');
      batch.splice(index, 1);
      localStorage.setItem('smartcrop_batch', JSON.stringify(batch));
      loadBatch();
    }

    function clearBatch() {
      localStorage.removeItem('smartcrop_batch');
      loadBatch();
    }

    loadBatch();
  </script>
</body>
</html>
